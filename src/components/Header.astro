---
import Close from "./icons/close.astro";
import Code from "./icons/code.astro";
import Home from "./icons/home.astro";
import Menu from "./icons/menu.astro";
import Moon from "./icons/moon.astro";
import Photo from "./icons/photo.astro";
import Send from "./icons/send.astro";
import Sun from "./icons/sun.astro";
import User from "./icons/user.astro";

const LINKS = [
  {
    href: "#inicio",
    name: "Inicio",
    icon: Home,
  },
  {
    href: "#proyectos",
    name: "Proyectos",
    icon: Photo,
  },
  {
    href: "#sobre-mi",
    name: "Sobre m√≠",
    icon: User,
  },
  {
    href: "#contacto",
    name: "Contacto",
    icon: Send,
  },
];
---

<header class="fixed z-40 w-full max-sm:bottom-0 sm:top-0">
  <div
    class="bg-gradient-to-r from-primary-100 to-primary-400 text-primary-900 dark:bg-primary-950 dark:bg-none dark:text-primary-300"
  >
    <nav
      id="nav"
      class="mx-auto flex max-w-3xl items-center justify-between overflow-hidden px-1"
    >
      <Code class="m-2 size-10" />

      <ul
        id="ul"
        class="flex flex-wrap transition-transform dark:bg-primary-950 dark:bg-none max-sm:fixed max-sm:bottom-14 max-sm:left-0 max-sm:-z-10 max-sm:w-full max-sm:translate-y-full max-sm:bg-gradient-to-r"
      >
        {
          LINKS.map((link) => (
            <li class="max-sm:flex-1">
              <a
                href={link.href}
                aria-label={link.name}
                class="flex flex-col items-center gap-0.5 whitespace-nowrap rounded-full p-4 pb-2 font-semibold leading-4 tracking-wider transition-colors max-sm:text-xs sm:py-1 sm:hover:bg-primary-50/40 sm:active:bg-primary-50/40 sm:dark:hover:bg-primary-700/50 sm:dark:active:bg-primary-700/50"
              >
                <link.icon class="size-6 sm:hidden" />
                {link.name}
              </a>
            </li>
          ))
        }
      </ul>

      <div class="flex">
        <button
          id="menu-toggle"
          type="button"
          title="Toggle menu"
          aria-label="Toggle menu"
          class="place-content-center px-3 py-4 transition-colors active:text-primary-600 dark:active:text-primary-600 sm:hidden"
        >
          <Menu id="menu-toggle-menu-icon" class="size-6" />
          <Close id="menu-toggle-close-icon" class="hidden size-6" />
        </button>

        <button
          id="theme-toggle"
          type="button"
          title="Cambiar tema"
          aria-label="Cambiar tema"
          class="place-content-center px-3 py-4 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary-600 active:text-primary-600 dark:active:text-primary-600"
        >
          <Sun id="theme-toggle-light-icon" class="hidden size-6" />
          <Moon id="theme-toggle-dark-icon" class="hidden size-6" />
        </button>
      </div>
    </nav>
  </div>
</header>

<script>
  // ==== DARK MODE ====
  const themeToggle = document.getElementById("theme-toggle");
  const lightIcon = document.getElementById("theme-toggle-light-icon");
  const darkIcon = document.getElementById("theme-toggle-dark-icon");

  // On page load or when changing themes, best to add inline in `head` to avoid FOUC
  if (
    localStorage.getItem("color-theme") === "dark" ||
    (!("color-theme" in localStorage) &&
      window.matchMedia("(prefers-color-scheme: dark)").matches)
  ) {
    document.documentElement.classList.add("dark");
    lightIcon?.classList.remove("hidden");
  } else {
    document.documentElement.classList.remove("dark");
    darkIcon?.classList.remove("hidden");
  }

  // On change system preferences theme
  window
    .matchMedia("(prefers-color-scheme: dark)")
    .addEventListener("change", (e) => {
      if (!("theme" in localStorage)) {
        if (e.matches) {
          document.documentElement.classList.add("dark");
          lightIcon?.classList.remove("hidden");
          darkIcon?.classList.add("hidden");
        } else {
          document.documentElement.classList.remove("dark");
          lightIcon?.classList.add("hidden");
          darkIcon?.classList.remove("hidden");
        }
      }
    });

  themeToggle?.addEventListener("click", () => {
    // toggle icons inside button
    darkIcon?.classList.toggle("hidden");
    lightIcon?.classList.toggle("hidden");

    // if set via local storage previously
    if (localStorage.getItem("color-theme")) {
      if (localStorage.getItem("color-theme") === "light") {
        document.documentElement.classList.add("dark");
        localStorage.setItem("color-theme", "dark");
      } else {
        document.documentElement.classList.remove("dark");
        localStorage.setItem("color-theme", "light");
      }

      // if NOT set via local storage previously
    } else {
      if (document.documentElement.classList.contains("dark")) {
        document.documentElement.classList.remove("dark");
        localStorage.setItem("color-theme", "light");
      } else {
        document.documentElement.classList.add("dark");
        localStorage.setItem("color-theme", "dark");
      }
    }
  });

  // On page unload, erase local storage
  window.addEventListener("beforeunload", () =>
    localStorage.removeItem("color-theme"),
  );

  // ==== TOGGLE MENU ====
  const menuToggle = document.getElementById("menu-toggle");
  const menuIcon = document.getElementById("menu-toggle-menu-icon");
  const closeIcon = document.getElementById("menu-toggle-close-icon");
  const ul = document.getElementById("ul");

  document.addEventListener("click", (e) => {
    const target = e.target as HTMLDivElement;
    if (
      target.closest("#menu-toggle") !== menuToggle &&
      target.closest("#theme-toggle") !== themeToggle
    ) {
      ul?.classList.add("max-sm:translate-y-full");
      menuIcon?.classList.remove("hidden");
      closeIcon?.classList.add("hidden");
    }
  });

  menuToggle?.addEventListener("click", () => {
    menuIcon?.classList.toggle("hidden");
    closeIcon?.classList.toggle("hidden");
    ul?.classList.toggle("max-sm:translate-y-full");
  });
</script>
